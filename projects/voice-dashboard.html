<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="robots" content="noindex, nofollow">
<title>Voice-Controlled Analytics Dashboard</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  background: #f5f5f7;
  color: #1d1d1f;
  padding: 16px;
  min-height: 100vh;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

header {
  text-align: center;
  margin-bottom: 20px;
}

h1 {
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.8px;
  margin-bottom: 4px;
  color: #1d1d1f;
}

.subtitle {
  font-size: 14px;
  font-weight: 400;
  color: #86868b;
  letter-spacing: -0.2px;
}

/* Filters Container */
.filters-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}

/* Voice Controls */
.voice-section {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}

.voice-section h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #1d1d1f;
  letter-spacing: -0.3px;
}

.voice-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
  margin-bottom: 16px;
}

.voice-btn {
  background: #1d1d1f;
  color: #FFFFFF;
  border: none;
  border-radius: 10px;
  padding: 12px 20px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
  letter-spacing: -0.2px;
}

.voice-btn:hover {
  background: #424245;
  transform: translateY(-1px);
}

.voice-btn:active {
  transform: translateY(0);
}

/* Touch-friendly tap targets */
@media (hover: none) and (pointer: coarse) {
  .voice-btn {
    min-height: 44px;
    padding: 14px 20px;
  }

  .filter-control select {
    min-height: 44px;
    padding: 12px;
  }

  /* Remove hover effects on touch devices */
  .voice-btn:hover {
    background: #1d1d1f;
    transform: none;
  }

  .filter-control select:hover {
    border-color: #d2d2d7;
  }
}

.voice-btn.listening {
  background: #FF3B30;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

.voice-btn.speaking {
  background: #34C759;
}

.voice-icon {
  font-size: 18px;
}

.voice-feedback {
  text-align: center;
  min-height: 50px;
  padding: 12px;
  background: #f5f5f7;
  border-radius: 8px;
}

.transcript {
  font-size: 13px;
  color: #86868b;
  margin-bottom: 4px;
  font-style: italic;
}

.command-result {
  font-size: 14px;
  color: #1d1d1f;
  font-weight: 500;
}

.voice-hints {
  margin-top: 12px;
  padding: 12px;
  background: #f9f9f9;
  border-radius: 8px;
}

.voice-hints h3 {
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 8px;
  color: #1d1d1f;
}

.voice-hints ul {
  list-style: none;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 6px;
}

.voice-hints li {
  font-size: 11px;
  color: #424245;
  padding: 6px 10px;
  background: #FFFFFF;
  border-radius: 6px;
}

.voice-hints code {
  color: #FF3B30;
  font-weight: 500;
}

/* Filters Display - Hidden, info shown in tags within filter sections */

/* Metrics Grid */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 20px;
}

.metric-card {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  transition: transform 0.2s;
}

.metric-card:hover {
  transform: translateY(-1px);
}

.metric-label {
  font-size: 11px;
  color: #86868b;
  margin-bottom: 8px;
  font-weight: 600;
  letter-spacing: 0.3px;
  text-transform: uppercase;
}

.metric-value {
  font-size: 36px;
  font-weight: 700;
  color: #1d1d1f;
  letter-spacing: -1.5px;
  margin-bottom: 4px;
}

.metric-change {
  font-size: 12px;
  font-weight: 500;
}

.metric-change.positive {
  color: #34C759;
}

.metric-change.negative {
  color: #FF3B30;
}

/* Data Table */
.data-section {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}

.data-section h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #1d1d1f;
  letter-spacing: -0.3px;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
}

.data-table thead {
  border-bottom: 1px solid #e5e5e7;
}

.data-table th {
  text-align: left;
  padding: 10px 12px;
  font-size: 11px;
  font-weight: 600;
  color: #86868b;
  letter-spacing: 0.2px;
  text-transform: uppercase;
}

.data-table td {
  padding: 12px;
  font-size: 13px;
  color: #1d1d1f;
  border-bottom: 1px solid #f5f5f7;
}

.data-table tbody tr:hover {
  background: #f9f9f9;
}

.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.status-badge.completed {
  background: #d1f4e0;
  color: #1a7f37;
}

.status-badge.active {
  background: #fff3cd;
  color: #8b6914;
}

.status-badge.missed {
  background: #ffdce0;
  color: #d1242f;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #86868b;
}

.empty-state-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-state-text {
  font-size: 17px;
}

/* Manual Filters */
.manual-filters {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}

.manual-filters h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #1d1d1f;
  letter-spacing: -0.3px;
}

.filter-controls {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.filter-control {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.filter-control label {
  font-size: 11px;
  font-weight: 600;
  color: #86868b;
  letter-spacing: 0.2px;
  text-transform: uppercase;
}

.filter-control select {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  font-size: 13px;
  padding: 10px 12px;
  border: 1px solid #d2d2d7;
  border-radius: 8px;
  background: #FFFFFF;
  color: #1d1d1f;
  cursor: pointer;
  transition: all 0.2s;
}

.filter-control select:hover {
  border-color: #1d1d1f;
}

.filter-control select:focus {
  outline: none;
  border-color: #1d1d1f;
  box-shadow: 0 0 0 2px rgba(29,29,31,0.1);
}

.voice-btn.paused {
  background: #FF9500;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  body {
    padding: 12px;
  }

  h1 {
    font-size: 24px;
  }

  .subtitle {
    font-size: 13px;
  }

  /* Stack filters vertically on mobile */
  .filters-container {
    grid-template-columns: 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  .voice-section,
  .manual-filters {
    padding: 16px;
  }

  .voice-section h2,
  .manual-filters h2 {
    font-size: 15px;
    margin-bottom: 10px;
  }

  /* Stack filter controls vertically on mobile */
  .filter-controls {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  /* Voice controls */
  .voice-controls {
    flex-wrap: wrap;
    gap: 8px;
  }

  .voice-btn {
    flex: 1;
    min-width: 100px;
    padding: 14px 16px;
    font-size: 13px;
  }

  .voice-icon {
    font-size: 16px;
  }

  .voice-hints h3 {
    font-size: 11px;
  }

  .voice-hints ul {
    grid-template-columns: 1fr;
    gap: 6px;
  }

  .voice-hints li {
    font-size: 11px;
    padding: 8px 12px;
  }

  /* Metrics - 1 column on mobile */
  .metrics-grid {
    grid-template-columns: 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  .metric-card {
    padding: 16px;
  }

  .metric-value {
    font-size: 32px;
  }

  .metric-label {
    font-size: 10px;
  }

  /* Data table - make scrollable */
  .data-section {
    padding: 16px;
  }

  .data-table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .data-table thead,
  .data-table tbody {
    display: table;
    width: 100%;
  }

  .data-section h2 {
    font-size: 15px;
    margin-bottom: 12px;
  }

  .data-table {
    font-size: 12px;
  }

  .data-table th {
    font-size: 10px;
    padding: 8px 10px;
  }

  .data-table td {
    font-size: 12px;
    padding: 10px;
    white-space: nowrap;
  }

  .status-badge {
    font-size: 11px;
    padding: 3px 10px;
  }
}

@media (max-width: 480px) {
  body {
    padding: 8px;
  }

  h1 {
    font-size: 20px;
  }

  .subtitle {
    font-size: 12px;
  }

  .voice-section,
  .manual-filters {
    padding: 12px;
  }

  .voice-btn {
    padding: 12px 14px;
    font-size: 12px;
  }

  .metric-value {
    font-size: 28px;
  }

  .data-table th,
  .data-table td {
    font-size: 11px;
    padding: 8px;
  }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Voice Analytics</h1>
    <p class="subtitle">Speak to filter. Listen to results. No touch required.</p>
  </header>

  <!-- Filters Container -->
  <div class="filters-container">
    <!-- Manual Filters -->
    <div class="manual-filters">
      <h2>üìä Manual Filters</h2>
      <div class="filter-controls">
        <div class="filter-control">
          <label>Date Range</label>
          <select id="dateFilter">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="yesterday">Yesterday</option>
            <option value="week">Last Week</option>
            <option value="month">This Month</option>
          </select>
        </div>
        <div class="filter-control">
          <label>Agent</label>
          <select id="agentFilter">
            <option value="all">All Agents</option>
            <option value="John Smith">John Smith</option>
            <option value="Sarah Johnson">Sarah Johnson</option>
            <option value="Mike Chen">Mike Chen</option>
          </select>
        </div>
        <div class="filter-control">
          <label>Status</label>
          <select id="statusFilter">
            <option value="all">All Statuses</option>
            <option value="completed">Completed</option>
            <option value="missed">Missed</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-section">
      <h2>üé§ Voice Filters</h2>
      <div class="voice-controls">
        <button class="voice-btn" id="listenBtn">
          <span class="voice-icon">üé§</span>
          <span id="listenBtnText">Listen</span>
        </button>
        <button class="voice-btn" id="speakBtn">
          <span class="voice-icon">üîä</span>
          <span id="speakBtnText">Read</span>
        </button>
        <button class="voice-btn" id="pauseBtn" style="display:none;">
          <span class="voice-icon">‚è∏Ô∏è</span>
          <span>Pause</span>
        </button>
      </div>

      <div class="voice-feedback">
        <div class="transcript" id="transcript">Say a command...</div>
        <div class="command-result" id="commandResult"></div>
      </div>

      <div class="voice-hints">
        <h3>üí° Commands:</h3>
        <ul>
          <li><code>"today"</code> <code>"yesterday"</code></li>
          <li><code>"agent John"</code> <code>"agent Sarah"</code></li>
          <li><code>"completed"</code> <code>"missed"</code></li>
          <li><code>"show all"</code> <code>"reset"</code></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Metrics -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-label">Total Calls</div>
      <div class="metric-value" id="metricTotal">--</div>
      <div class="metric-change positive" id="metricTotalChange"></div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Avg Duration</div>
      <div class="metric-value" id="metricAvgDuration">--</div>
      <div class="metric-change" id="metricAvgChange"></div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Completion Rate</div>
      <div class="metric-value" id="metricCompletionRate">--</div>
      <div class="metric-change positive" id="metricCompletionChange"></div>
    </div>
  </div>

  <!-- Data Table -->
  <div class="data-section">
    <h2>Call Details</h2>
    <table class="data-table">
      <thead>
        <tr>
          <th>Time</th>
          <th>Agent</th>
          <th>Customer</th>
          <th>Duration</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="dataTableBody">
        <!-- Populated by JavaScript -->
      </tbody>
    </table>
  </div>
</div>

<script>
// Sample Data
const callData = [
  { time: '2026-02-14 09:15', agent: 'John Smith', customer: 'Alice Brown', duration: 245, status: 'completed' },
  { time: '2026-02-14 09:42', agent: 'Sarah Johnson', customer: 'Bob Wilson', duration: 180, status: 'completed' },
  { time: '2026-02-14 10:05', agent: 'John Smith', customer: 'Carol Davis', duration: 0, status: 'missed' },
  { time: '2026-02-14 10:30', agent: 'Mike Chen', customer: 'David Lee', duration: 420, status: 'completed' },
  { time: '2026-02-14 11:15', agent: 'Sarah Johnson', customer: 'Emma Taylor', duration: 310, status: 'completed' },
  { time: '2026-02-13 14:20', agent: 'John Smith', customer: 'Frank Moore', duration: 195, status: 'completed' },
  { time: '2026-02-13 15:45', agent: 'Mike Chen', customer: 'Grace White', duration: 0, status: 'missed' },
  { time: '2026-02-13 16:10', agent: 'Sarah Johnson', customer: 'Henry Black', duration: 270, status: 'completed' },
  { time: '2026-02-12 09:30', agent: 'John Smith', customer: 'Iris Green', duration: 340, status: 'completed' },
  { time: '2026-02-12 11:00', agent: 'Mike Chen', customer: 'Jack Brown', duration: 220, status: 'completed' },
  { time: '2026-02-12 13:45', agent: 'Sarah Johnson', customer: 'Kate Wilson', duration: 0, status: 'missed' },
  { time: '2026-02-12 15:20', agent: 'John Smith', customer: 'Leo Davis', duration: 280, status: 'completed' },
];

// State
let filters = {
  date: 'all',
  agent: 'all',
  status: 'all'
};

// Speech Recognition
let recognition = null;
let isListening = false;

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';

  recognition.onstart = function() {
    isListening = true;
    document.getElementById('listenBtn').classList.add('listening');
    document.getElementById('listenBtnText').textContent = 'Listening...';
    document.getElementById('transcript').textContent = 'Listening for your command...';
    document.getElementById('commandResult').textContent = '';
  };

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript.toLowerCase();
    console.log('üé§ Speech recognized:', transcript);
    document.getElementById('transcript').textContent = `You said: "${transcript}"`;

    // Voice confirmation - repeat what was heard
    if ('speechSynthesis' in window) {
      console.log('üîä Speaking confirmation...');
      const confirmation = new SpeechSynthesisUtterance(`You said: ${transcript}`);
      confirmation.rate = 1.2;
      confirmation.pitch = 1;
      confirmation.volume = 0.8;
      speechSynthesis.speak(confirmation);

      // Process command after confirmation
      confirmation.onend = function() {
        console.log('‚úÖ Confirmation finished, processing command...');
        processVoiceCommand(transcript);
      };
    } else {
      console.log('‚ö†Ô∏è No TTS support, processing command directly...');
      processVoiceCommand(transcript);
    }
  };

  recognition.onerror = function(event) {
    console.error('Speech recognition error:', event.error);
    document.getElementById('transcript').textContent = 'Error: Could not recognize speech. Try again.';
    resetListenButton();
  };

  recognition.onend = function() {
    resetListenButton();
  };
}

function resetListenButton() {
  isListening = false;
  document.getElementById('listenBtn').classList.remove('listening');
  document.getElementById('listenBtnText').textContent = 'Start Listening';
}

document.getElementById('listenBtn').addEventListener('click', function() {
  if (!recognition) {
    alert('Speech recognition is not supported in your browser. Please use Chrome or Edge.');
    return;
  }

  if (isListening) {
    recognition.stop();
  } else {
    recognition.start();
  }
});

// Voice Command Processing
function processVoiceCommand(command) {
  console.log('üé§ Processing voice command:', command);
  console.log('üìä Filters BEFORE:', JSON.stringify(filters));

  let executed = false;

  // Date filters
  if (command.includes('today')) {
    filters.date = 'today';
    executed = true;
    console.log('‚úì Matched: today');
  } else if (command.includes('yesterday')) {
    filters.date = 'yesterday';
    executed = true;
    console.log('‚úì Matched: yesterday');
  } else if (command.includes('last week') || command.includes('this week')) {
    filters.date = 'week';
    executed = true;
    console.log('‚úì Matched: week');
  } else if (command.includes('this month') || command.includes('last month')) {
    filters.date = 'month';
    executed = true;
    console.log('‚úì Matched: month');
  }

  // Agent filters
  if (command.includes('john')) {
    filters.agent = 'John Smith';
    executed = true;
    console.log('‚úì Matched: john');
  } else if (command.includes('sarah')) {
    filters.agent = 'Sarah Johnson';
    executed = true;
    console.log('‚úì Matched: sarah');
  } else if (command.includes('mike')) {
    filters.agent = 'Mike Chen';
    executed = true;
    console.log('‚úì Matched: mike');
  } else if (command.includes('all agent')) {
    filters.agent = 'all';
    executed = true;
    console.log('‚úì Matched: all agents');
  }

  // Status filters
  if (command.includes('completed')) {
    filters.status = 'completed';
    executed = true;
    console.log('‚úì Matched: completed');
  } else if (command.includes('missed')) {
    filters.status = 'missed';
    executed = true;
    console.log('‚úì Matched: missed');
  } else if (command.includes('all status') || command.includes('all calls')) {
    filters.status = 'all';
    executed = true;
    console.log('‚úì Matched: all status');
  }

  // Reset
  if (command.includes('reset') || command.includes('show all') || command.includes('clear filter')) {
    filters = { date: 'all', agent: 'all', status: 'all' };
    executed = true;
    console.log('‚úì Matched: reset');
  }

  console.log('üìä Filters AFTER:', JSON.stringify(filters));

  if (executed) {
    console.log('üîÑ Calling updateDashboard()');
    updateDashboard();
    console.log('üîÑ Calling syncManualControls()');
    syncManualControls();
    console.log('‚úÖ Dashboard and controls updated');
    document.getElementById('commandResult').textContent = '‚úì Filters applied successfully';
  } else {
    console.log('‚ùå No command matched');
    document.getElementById('commandResult').textContent = '‚ö†Ô∏è Command not recognized. Try again.';
  }
}

// Sync manual controls with filter state
function syncManualControls() {
  console.log('üîÑ syncManualControls() called');
  console.log('  Setting dateFilter to:', filters.date);
  document.getElementById('dateFilter').value = filters.date;
  console.log('  Setting agentFilter to:', filters.agent);
  document.getElementById('agentFilter').value = filters.agent;
  console.log('  Setting statusFilter to:', filters.status);
  document.getElementById('statusFilter').value = filters.status;
  console.log('‚úÖ Manual controls synced');
}

// Text-to-Speech
let currentUtterance = null;
let isSpeaking = false;

document.getElementById('speakBtn').addEventListener('click', function() {
  if (!('speechSynthesis' in window)) {
    alert('Text-to-speech is not supported in your browser.');
    return;
  }

  const speakBtn = this;
  const pauseBtn = document.getElementById('pauseBtn');

  speakBtn.classList.add('speaking');
  pauseBtn.style.display = 'flex';

  const filteredData = getFilteredData();
  const summary = generateSummary(filteredData);

  currentUtterance = new SpeechSynthesisUtterance(summary);
  currentUtterance.rate = 1.2; // Faster speech
  currentUtterance.pitch = 1;
  currentUtterance.volume = 1;

  currentUtterance.onend = function() {
    speakBtn.classList.remove('speaking');
    pauseBtn.style.display = 'none';
    isSpeaking = false;
    document.getElementById('speakBtnText').textContent = 'Read Results';
  };

  speechSynthesis.cancel(); // Cancel any ongoing speech
  speechSynthesis.speak(currentUtterance);
  isSpeaking = true;
  document.getElementById('speakBtnText').textContent = 'Speaking...';
});

// Pause/Resume TTS
document.getElementById('pauseBtn').addEventListener('click', function() {
  if (!('speechSynthesis' in window)) return;

  const pauseBtn = this;
  const speakBtn = document.getElementById('speakBtn');

  if (speechSynthesis.paused) {
    speechSynthesis.resume();
    pauseBtn.innerHTML = '<span class="voice-icon">‚è∏Ô∏è</span><span>Pause</span>';
    speakBtn.classList.add('speaking');
    speakBtn.classList.remove('paused');
  } else {
    speechSynthesis.pause();
    pauseBtn.innerHTML = '<span class="voice-icon">‚ñ∂Ô∏è</span><span>Resume</span>';
    speakBtn.classList.remove('speaking');
    speakBtn.classList.add('paused');
  }
});

function generateSummary(data) {
  const total = data.length;
  const completed = data.filter(d => d.status === 'completed').length;
  const missed = data.filter(d => d.status === 'missed').length;

  const totalDuration = data.reduce((sum, d) => sum + d.duration, 0);
  const avgDuration = total > 0 ? Math.round(totalDuration / total) : 0;
  const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

  let summary = '';

  // Opening with context
  const activeFilterCount = [filters.date, filters.agent, filters.status].filter(f => f !== 'all').length;

  if (activeFilterCount === 0) {
    summary += `Looking at all calls in the system. `;
  } else if (activeFilterCount === 1) {
    if (filters.date !== 'all') {
      const dateLabels = { today: "today's", yesterday: "yesterday's", week: "this week's", month: "this month's" };
      summary += `Showing ${dateLabels[filters.date] || filters.date} calls. `;
    } else if (filters.agent !== 'all') {
      summary += `Filtering by ${filters.agent}'s calls. `;
    } else {
      summary += `Looking at ${filters.status} calls only. `;
    }
  } else {
    let parts = [];
    if (filters.date !== 'all') {
      const dateLabels = { today: "today", yesterday: "yesterday", week: "this week", month: "this month" };
      parts.push(dateLabels[filters.date] || filters.date);
    }
    if (filters.agent !== 'all') parts.push(filters.agent);
    if (filters.status !== 'all') parts.push(filters.status + ' calls');
    summary += `Filtering by ${parts.join(', ')}. `;
  }

  // Main metrics with natural flow
  if (total === 0) {
    summary += `No calls match these filters.`;
    return summary;
  } else if (total === 1) {
    summary += `Found one call. `;
  } else {
    summary += `Found ${total} calls in total. `;
  }

  // Completion details
  if (completed === total) {
    summary += `All calls were completed successfully. `;
  } else if (completed === 0) {
    summary += `Unfortunately, none were completed. `;
  } else {
    summary += `Out of these, ${completed} ${completed === 1 ? 'was' : 'were'} completed, `;
    if (missed > 0) {
      summary += `and ${missed} ${missed === 1 ? 'was' : 'were'} missed. `;
    } else {
      summary += `with no missed calls. `;
    }
  }

  // Duration info
  if (avgDuration > 0) {
    const minutes = Math.floor(avgDuration / 60);
    const seconds = avgDuration % 60;

    if (minutes > 0) {
      summary += `Average call duration is ${minutes} ${minutes === 1 ? 'minute' : 'minutes'}`;
      if (seconds > 0) summary += ` and ${seconds} seconds`;
      summary += `. `;
    } else {
      summary += `Average call duration is ${seconds} seconds. `;
    }
  }

  // Completion rate with context
  if (completionRate === 100) {
    summary += `Perfect completion rate at one hundred percent.`;
  } else if (completionRate >= 90) {
    summary += `Strong completion rate at ${completionRate} percent.`;
  } else if (completionRate >= 70) {
    summary += `Decent completion rate at ${completionRate} percent.`;
  } else if (completionRate >= 50) {
    summary += `Completion rate is ${completionRate} percent.`;
  } else {
    summary += `Completion rate needs improvement at ${completionRate} percent.`;
  }

  return summary;
}

// Data Filtering
function getFilteredData() {
  return callData.filter(call => {
    // Date filter
    const callDate = new Date(call.time);
    const today = new Date('2026-02-14');
    const yesterday = new Date('2026-02-13');

    let dateMatch = true;
    if (filters.date === 'today') {
      dateMatch = callDate.toDateString() === today.toDateString();
    } else if (filters.date === 'yesterday') {
      dateMatch = callDate.toDateString() === yesterday.toDateString();
    } else if (filters.date === 'week') {
      const weekAgo = new Date(today);
      weekAgo.setDate(weekAgo.getDate() - 7);
      dateMatch = callDate >= weekAgo;
    } else if (filters.date === 'month') {
      dateMatch = callDate.getMonth() === today.getMonth();
    }

    // Agent filter
    const agentMatch = filters.agent === 'all' || call.agent === filters.agent;

    // Status filter
    const statusMatch = filters.status === 'all' || call.status === filters.status;

    return dateMatch && agentMatch && statusMatch;
  });
}

// Update Dashboard
function updateDashboard() {
  console.log('üìä updateDashboard() called with filters:', JSON.stringify(filters));
  const filteredData = getFilteredData();
  console.log('üìä Filtered data count:', filteredData.length);

  // Update metrics
  const total = filteredData.length;
  const completed = filteredData.filter(d => d.status === 'completed').length;
  const totalDuration = filteredData.reduce((sum, d) => sum + d.duration, 0);
  const avgDuration = total > 0 ? Math.round(totalDuration / total) : 0;
  const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

  console.log('üìä Metrics - Total:', total, 'Avg Duration:', avgDuration, 'Completion:', completionRate + '%');

  document.getElementById('metricTotal').textContent = total;
  document.getElementById('metricAvgDuration').textContent = avgDuration + 's';
  document.getElementById('metricCompletionRate').textContent = completionRate + '%';

  // Update table
  const tbody = document.getElementById('dataTableBody');
  if (filteredData.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="5">
          <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <div class="empty-state-text">No calls match your filters</div>
          </div>
        </td>
      </tr>
    `;
  } else {
    tbody.innerHTML = filteredData.map(call => `
      <tr>
        <td>${call.time.split(' ')[1]}</td>
        <td>${call.agent}</td>
        <td>${call.customer}</td>
        <td>${call.duration > 0 ? call.duration + 's' : '-'}</td>
        <td><span class="status-badge ${call.status}">${call.status}</span></td>
      </tr>
    `).join('');
  }
}

// Manual Filter Controls
document.getElementById('dateFilter').addEventListener('change', function() {
  filters.date = this.value;
  updateDashboard();
  document.getElementById('commandResult').textContent = '‚úì Date filter updated';
});

document.getElementById('agentFilter').addEventListener('change', function() {
  filters.agent = this.value;
  updateDashboard();
  document.getElementById('commandResult').textContent = '‚úì Agent filter updated';
});

document.getElementById('statusFilter').addEventListener('change', function() {
  filters.status = this.value;
  updateDashboard();
  document.getElementById('commandResult').textContent = '‚úì Status filter updated';
});

// Initialize
updateDashboard();
syncManualControls();
</script>
</body>
</html>
