<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;display:flex;align-items:center;justify-content:center;height:100vh;font-family:'Segoe UI',sans-serif;overflow:hidden;user-select:none}
.wrap{text-align:center}
canvas{border:2px solid #16213e;border-radius:8px;background:#0f3460;box-shadow:0 0 20px rgba(83,52,131,.4)}
.hud{display:flex;justify-content:space-between;align-items:center;padding:6px 12px;color:#e94560;font-size:13px;font-weight:700}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(15,52,96,.85);border-radius:8px;color:#fff;cursor:pointer;z-index:2}
.overlay h2{font-size:18px;margin-bottom:6px;color:#e94560}
.overlay p{font-size:12px;color:#aaa}
.game{position:relative;display:inline-block}
</style>
</head>
<body>
<div class="wrap">
<div class="hud"><span id="score">Skor: 0</span><span id="best">En ƒ∞yi: 0</span></div>
<div class="game">
<canvas id="c" width="300" height="300"></canvas>
<div class="overlay" id="overlay">
<h2 id="otitle">üêç Snake</h2>
<p id="osub">Ba≈ülamak i√ßin tƒ±kla<br>veya WASD / Ok tu≈ülarƒ±</p>
</div>
</div>
</div>
<script>
var c = document.getElementById('c');
var ctx = c.getContext('2d');
var G = 15;
var S = c.width / G;
var overlay = document.getElementById('overlay');
var otitle = document.getElementById('otitle');
var osub = document.getElementById('osub');
var scoreEl = document.getElementById('score');
var bestEl = document.getElementById('best');

var snake, dir, ndir, food, score, alive, loop;
var best = parseInt(localStorage.getItem('snakeBest')) || 0;
bestEl.textContent = 'En ƒ∞yi: ' + best;

function startGame() {
  overlay.style.display = 'none';
  snake = [{x:7,y:7},{x:6,y:7},{x:5,y:7}];
  dir = {x:1, y:0};
  ndir = {x:1, y:0};
  score = 0;
  alive = true;
  scoreEl.textContent = 'Skor: 0';
  placeFood();
  draw();
  if (loop) clearInterval(loop);
  loop = setInterval(tick, 130);
}

function placeFood() {
  var f;
  do {
    f = {x: Math.floor(Math.random()*G), y: Math.floor(Math.random()*G)};
  } while (snake.some(function(s){ return s.x===f.x && s.y===f.y; }));
  food = f;
}

function die() {
  alive = false;
  clearInterval(loop);
  loop = null;
  if (score > best) {
    best = score;
    localStorage.setItem('snakeBest', best);
    bestEl.textContent = 'En ƒ∞yi: ' + best;
  }
  otitle.textContent = 'üíÄ ' + score + ' Puan!';
  osub.textContent = 'Tekrar oynamak i√ßin tƒ±kla';
  overlay.style.display = 'flex';
}

function tick() {
  if (!alive) return;
  dir = {x: ndir.x, y: ndir.y};
  var h = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

  // duvar kontrol√º
  if (h.x < 0 || h.x >= G || h.y < 0 || h.y >= G) { die(); return; }
  // kendine √ßarpma
  for (var i = 0; i < snake.length; i++) {
    if (snake[i].x === h.x && snake[i].y === h.y) { die(); return; }
  }

  snake.unshift(h);
  if (h.x === food.x && h.y === food.y) {
    score++;
    scoreEl.textContent = 'Skor: ' + score;
    placeFood();
  } else {
    snake.pop();
  }
  draw();
}

function drawRect(x, y, w, h, r, color) {
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.lineTo(x+w-r, y);
  ctx.quadraticCurveTo(x+w, y, x+w, y+r);
  ctx.lineTo(x+w, y+h-r);
  ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
  ctx.lineTo(x+r, y+h);
  ctx.quadraticCurveTo(x, y+h, x, y+h-r);
  ctx.lineTo(x, y+r);
  ctx.quadraticCurveTo(x, y, x+r, y);
  ctx.closePath();
  ctx.fill();
}

function draw() {
  // arkaplan
  ctx.fillStyle = '#0f3460';
  ctx.fillRect(0, 0, c.width, c.height);

  // grid
  ctx.strokeStyle = 'rgba(22,33,62,0.6)';
  ctx.lineWidth = 0.5;
  for (var i = 0; i <= G; i++) {
    ctx.beginPath(); ctx.moveTo(i*S, 0); ctx.lineTo(i*S, c.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0, i*S); ctx.lineTo(c.width, i*S); ctx.stroke();
  }

  // yem - parlayan kƒ±rmƒ±zƒ± daire
  ctx.fillStyle = '#e94560';
  ctx.shadowColor = '#e94560';
  ctx.shadowBlur = 8;
  ctx.beginPath();
  ctx.arc(food.x*S + S/2, food.y*S + S/2, S/2 - 2, 0, Math.PI*2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // yƒ±lan
  for (var i = 0; i < snake.length; i++) {
    var s = snake[i];
    var t = i / Math.max(snake.length - 1, 1);
    var color;
    if (i === 0) {
      color = '#53d769';
    } else {
      var r = Math.round(30 + 50*t);
      var g = Math.round(180 - 80*t);
      var b = Math.round(60 + 40*t);
      color = 'rgb('+r+','+g+','+b+')';
    }
    drawRect(s.x*S+1, s.y*S+1, S-2, S-2, 3, color);
  }

  // kafa g√∂zleri
  if (snake.length > 0) {
    var head = snake[0];
    var cx = head.x*S + S/2;
    var cy = head.y*S + S/2;
    var ex1, ey1, ex2, ey2;
    if (dir.x === 1) { ex1=cx+3; ey1=cy-3; ex2=cx+3; ey2=cy+3; }
    else if (dir.x === -1) { ex1=cx-3; ey1=cy-3; ex2=cx-3; ey2=cy+3; }
    else if (dir.y === -1) { ex1=cx-3; ey1=cy-3; ex2=cx+3; ey2=cy-3; }
    else { ex1=cx-3; ey1=cy+3; ex2=cx+3; ey2=cy+3; }
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(ex1, ey1, 2, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(ex2, ey2, 2, 0, Math.PI*2); ctx.fill();
  }
}

// klavye
document.addEventListener('keydown', function(e) {
  var k = e.key;
  if ((k==='ArrowUp'||k==='w'||k==='W') && dir.y!==1) ndir={x:0,y:-1};
  else if ((k==='ArrowDown'||k==='s'||k==='S') && dir.y!==-1) ndir={x:0,y:1};
  else if ((k==='ArrowLeft'||k==='a'||k==='A') && dir.x!==1) ndir={x:-1,y:0};
  else if ((k==='ArrowRight'||k==='d'||k==='D') && dir.x!==-1) ndir={x:1,y:0};
  e.preventDefault();
});

// tƒ±klama ile ba≈ülat
overlay.addEventListener('click', startGame);

// dokunmatik
var tx, ty;
document.addEventListener('touchstart', function(e){ tx=e.touches[0].clientX; ty=e.touches[0].clientY; });
document.addEventListener('touchend', function(e){
  if (!alive) return;
  var dx = e.changedTouches[0].clientX - tx;
  var dy = e.changedTouches[0].clientY - ty;
  if (Math.abs(dx) < 10 && Math.abs(dy) < 10) return;
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 0 && dir.x !== -1) ndir={x:1,y:0};
    else if (dx < 0 && dir.x !== 1) ndir={x:-1,y:0};
  } else {
    if (dy > 0 && dir.y !== -1) ndir={x:0,y:1};
    else if (dy < 0 && dir.y !== 1) ndir={x:0,y:-1};
  }
});
</script>
</body>
</html>
