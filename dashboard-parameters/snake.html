<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>Snake</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#FFFFFF;display:flex;align-items:center;justify-content:center;height:100vh;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;overflow:hidden;user-select:none}
.wrap{text-align:center;position:relative}
canvas#c{border-radius:8px;background:#f5f5f7;position:relative;z-index:1}
.hud{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;color:#1d1d1f;font-size:12px;font-weight:600;position:relative;z-index:1;letter-spacing:-0.2px}
.hud .player-name{font-size:10px;color:#86868b;opacity:.9}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,.95);border-radius:8px;color:#1d1d1f;cursor:default;z-index:3;overflow:hidden}
.overlay h2{font-size:16px;margin-bottom:8px;color:#1d1d1f;letter-spacing:-0.3px;font-weight:600}
.overlay p{font-size:11px;color:#86868b}
.game{position:relative;display:inline-block}

/* Login Screen */
#loginScreen{display:flex;flex-direction:column;align-items:center;width:100%;padding:0 20px}
#loginScreen h2{margin-bottom:12px}
#loginScreen input{background:#FFFFFF;border:1px solid rgba(0,0,0,0.15);color:#1d1d1f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:12px;padding:8px 12px;border-radius:6px;width:180px;text-align:center;outline:none;margin-bottom:8px}
#loginScreen input:focus{border-color:#1d1d1f}
#loginScreen input::placeholder{color:#86868b}
.prev-players{max-height:80px;overflow-y:auto;width:180px;margin-bottom:8px}
.prev-players::-webkit-scrollbar{width:4px}
.prev-players::-webkit-scrollbar-thumb{background:#d2d2d7;border-radius:2px}
.prev-btn{background:#FFFFFF;border:1px solid rgba(0,0,0,0.08);color:#424245;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:10px;padding:4px 10px;cursor:pointer;width:100%;text-align:left;margin-bottom:2px;border-radius:4px;transition:all .15s}
.prev-btn:hover{background:#f5f5f7;border-color:rgba(0,0,0,0.15);color:#1d1d1f}
.prev-label{font-size:9px;color:#86868b;letter-spacing:0.5px;margin-bottom:4px;text-align:left;width:180px;font-weight:500}
.start-btn{background:#1d1d1f;border:none;color:#FFFFFF;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:12px;padding:8px 24px;cursor:pointer;border-radius:6px;letter-spacing:-0.2px;transition:all .2s;margin-top:6px;font-weight:500}
.start-btn:hover{background:#424245}
.start-btn:disabled{opacity:.4;cursor:default}

/* Game Over Screen */
#deathScreen{display:none;flex-direction:column;align-items:center;width:100%;padding:0 15px}
#deathScreen h2{margin-bottom:6px}
#deathScore{font-size:11px;color:#86868b;margin-bottom:12px}

/* Leaderboard */
.lb{width:100%;max-width:260px}
.lb-title{font-size:9px;color:#86868b;letter-spacing:0.5px;margin-bottom:6px;text-align:center;font-weight:500}
.lb-table{width:100%;border-collapse:collapse}
.lb-table tr{border-bottom:1px solid rgba(0,0,0,0.06)}
.lb-table td{padding:3px 4px;font-size:10px;color:#424245}
.lb-table td:first-child{color:#86868b;width:18px;text-align:right;padding-right:8px}
.lb-table td:nth-child(2){color:#1d1d1f;font-weight:500}
.lb-table td:last-child{text-align:right;color:#1d1d1f;font-weight:600}
.lb-table tr.me td{color:#1d1d1f;font-weight:600}
.lb-table tr.me td:first-child{color:#1d1d1f}
.replay-btn{background:#FFFFFF;border:1px solid rgba(0,0,0,0.15);color:#1d1d1f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:11px;padding:6px 18px;cursor:pointer;border-radius:6px;letter-spacing:-0.2px;margin-top:12px;transition:all .2s;font-weight:500}
.replay-btn:hover{background:#f5f5f7;border-color:rgba(0,0,0,0.2)}
.switch-btn{background:none;border:none;color:#86868b;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:9px;cursor:pointer;margin-top:8px;text-decoration:none}
.switch-btn:hover{color:#1d1d1f;text-decoration:underline}
</style>
</head>
<body>
<div class="wrap">
<div class="hud">
  <span id="score">Skor: 0</span>
  <span id="playerHud" class="player-name"></span>
  <span id="best">En Y√ºksek: 0</span>
</div>
<div class="game">
<canvas id="c" width="300" height="300"></canvas>
<div class="overlay" id="overlay">

  <!-- LOGIN SCREEN -->
  <div id="loginScreen">
    <h2>üêç SNAKE</h2>
    <input type="text" id="nameInput" placeholder="ƒ∞sminizi girin" maxlength="12" autocomplete="off" spellcheck="false">
    <div id="prevPlayers" class="prev-players"></div>
    <button class="start-btn" id="startBtn" disabled>Ba≈üla</button>
    <p style="margin-top:10px;font-size:10px;color:#86868b">WASD veya ok tu≈ülarƒ±</p>
  </div>

  <!-- DEATH / LEADERBOARD SCREEN -->
  <div id="deathScreen">
    <h2 id="deathTitle">Oyun Bitti</h2>
    <div id="deathScore"></div>
    <div class="lb">
      <div class="lb-title">LIDERLIK TABLOSU</div>
      <table class="lb-table"><tbody id="lbBody"></tbody></table>
    </div>
    <button class="replay-btn" id="replayBtn">Tekrar Oyna</button>
    <button class="switch-btn" id="switchBtn">Oyuncu deƒüi≈ütir</button>
  </div>

</div>
</div>
</div>
<script>
// --- SOUND ENGINE ---
var audioCtx=null;
function initAudio(){if(audioCtx)return;audioCtx=new(window.AudioContext||window.webkitAudioContext)()}
function playEat(){if(!audioCtx)return;var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='square';o.frequency.setValueAtTime(300,audioCtx.currentTime);o.frequency.exponentialRampToValueAtTime(900,audioCtx.currentTime+.08);o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+.12);g.gain.setValueAtTime(.15,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.15);o.start(audioCtx.currentTime);o.stop(audioCtx.currentTime+.15)}
function playTurn(){if(!audioCtx)return;var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sine';o.frequency.setValueAtTime(800,audioCtx.currentTime);g.gain.setValueAtTime(.04,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.04);o.start(audioCtx.currentTime);o.stop(audioCtx.currentTime+.04)}
function playDie(){if(!audioCtx)return;for(var n=0;n<5;n++){var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sawtooth';var t=audioCtx.currentTime+n*.07;o.frequency.setValueAtTime(400-n*60,t);o.frequency.exponentialRampToValueAtTime(40,t+.06);g.gain.setValueAtTime(.12,t);g.gain.exponentialRampToValueAtTime(.001,t+.07);o.start(t);o.stop(t+.07)}var bs=audioCtx.sampleRate*.3,buf=audioCtx.createBuffer(1,bs,audioCtx.sampleRate),d=buf.getChannelData(0);for(var i=0;i<bs;i++)d[i]=(Math.random()*2-1)*.1;var ns=audioCtx.createBufferSource(),ng=audioCtx.createGain();ns.buffer=buf;ns.connect(ng);ng.connect(audioCtx.destination);ng.gain.setValueAtTime(.15,audioCtx.currentTime);ng.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);ns.start(audioCtx.currentTime);ns.stop(audioCtx.currentTime+.3)}
function playStart(){if(!audioCtx)return;var notes=[200,300,400,600,800];for(var n=0;n<notes.length;n++){var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='square';var t=audioCtx.currentTime+n*.06;o.frequency.setValueAtTime(notes[n],t);g.gain.setValueAtTime(.08,t);g.gain.exponentialRampToValueAtTime(.001,t+.08);o.start(t);o.stop(t+.08)}}

// --- LEADERBOARD DATA ---
function getLeaderboard(){
  try{return JSON.parse(localStorage.getItem('snakeLB'))||[]}catch(e){return[]}
}
function saveLeaderboard(lb){
  localStorage.setItem('snakeLB',JSON.stringify(lb));
}
function getPlayers(){
  var lb=getLeaderboard();
  var names={};
  for(var i=0;i<lb.length;i++) names[lb[i].name]=1;
  return Object.keys(names).sort();
}
function addScore(name,sc){
  var lb=getLeaderboard();
  lb.push({name:name,score:sc,date:Date.now()});
  saveLeaderboard(lb);
}
function getTop10(){
  var lb=getLeaderboard();
  // per-player best score
  var best={};
  for(var i=0;i<lb.length;i++){
    var e=lb[i];
    if(!best[e.name]||e.score>best[e.name].score) best[e.name]=e;
  }
  var arr=[];
  for(var k in best) arr.push(best[k]);
  arr.sort(function(a,b){return b.score-a.score});
  return arr.slice(0,10);
}
function getPlayerBest(name){
  var lb=getLeaderboard();
  var b=0;
  for(var i=0;i<lb.length;i++){
    if(lb[i].name===name&&lb[i].score>b)b=lb[i].score;
  }
  return b;
}

// --- GAME ---
var c=document.getElementById('c'),ctx=c.getContext('2d');
var G=15,S=c.width/G;
var overlay=document.getElementById('overlay');
var scoreEl=document.getElementById('score');
var bestEl=document.getElementById('best');
var playerHud=document.getElementById('playerHud');
var loginScreen=document.getElementById('loginScreen');
var deathScreen=document.getElementById('deathScreen');
var nameInput=document.getElementById('nameInput');
var startBtn=document.getElementById('startBtn');
var prevPlayersDiv=document.getElementById('prevPlayers');
var deathTitle=document.getElementById('deathTitle');
var deathScore=document.getElementById('deathScore');
var lbBody=document.getElementById('lbBody');
var replayBtn=document.getElementById('replayBtn');
var switchBtn=document.getElementById('switchBtn');

var snake,dir,ndir,food,score,alive,loop;
var currentPlayer='';
var best=0;
var particles=[];

// --- LOGIN ---
function showLogin(){
  loginScreen.style.display='flex';
  deathScreen.style.display='none';
  overlay.style.display='flex';
  overlay.style.cursor='default';
  nameInput.value='';
  startBtn.disabled=true;
  renderPrevPlayers();
  setTimeout(function(){nameInput.focus()},100);
}

function renderPrevPlayers(){
  var players=getPlayers();
  prevPlayersDiv.innerHTML='';
  if(players.length===0)return;
  var label=document.createElement('div');
  label.className='prev-label';
  label.textContent='√ñNCEKƒ∞ OYUNCULAR';
  prevPlayersDiv.appendChild(label);
  for(var i=0;i<players.length;i++){
    var btn=document.createElement('button');
    btn.className='prev-btn';
    var pb=getPlayerBest(players[i]);
    btn.textContent=players[i]+(pb>0?' [en y√ºksek: '+pb+']':'');
    btn.setAttribute('data-name',players[i]);
    btn.addEventListener('click',function(){
      nameInput.value=this.getAttribute('data-name');
      startBtn.disabled=false;
      nameInput.focus();
    });
    prevPlayersDiv.appendChild(btn);
  }
}

nameInput.addEventListener('input',function(){
  startBtn.disabled=nameInput.value.trim().length===0;
});
nameInput.addEventListener('keydown',function(e){
  if(e.key==='Enter'&&nameInput.value.trim().length>0){
    e.preventDefault();
    selectPlayerAndStart();
  }
  e.stopPropagation();
});
startBtn.addEventListener('click',function(){
  selectPlayerAndStart();
});

function selectPlayerAndStart(){
  var name=nameInput.value.trim().toUpperCase();
  if(!name)return;
  currentPlayer=name;
  best=getPlayerBest(currentPlayer);
  bestEl.textContent='En Y√ºksek: '+best;
  playerHud.textContent=currentPlayer;
  startGame();
}

// --- DEATH / LEADERBOARD ---
function showDeath(){
  loginScreen.style.display='none';
  deathScreen.style.display='flex';
  overlay.style.display='flex';

  addScore(currentPlayer,score);
  if(score>best){
    best=score;
    bestEl.textContent='En Y√ºksek: '+best;
  }

  deathTitle.textContent='Oyun Bitti - Skor: '+score;
  deathScore.textContent=currentPlayer;

  // render leaderboard
  var top=getTop10();
  lbBody.innerHTML='';
  for(var i=0;i<top.length;i++){
    var tr=document.createElement('tr');
    if(top[i].name===currentPlayer)tr.className='me';
    var rank=document.createElement('td');rank.textContent=(i+1)+'.';
    var nm=document.createElement('td');nm.textContent=top[i].name;
    var sc=document.createElement('td');sc.textContent=top[i].score;
    tr.appendChild(rank);tr.appendChild(nm);tr.appendChild(sc);
    lbBody.appendChild(tr);
  }
}

replayBtn.addEventListener('click',function(){startGame()});
switchBtn.addEventListener('click',function(){showLogin()});

// --- GAME CORE ---
function spawnParticles(x,y,count){
  var chars='‚óè‚ñ†‚óÜ‚ñ≤';
  for(var i=0;i<count;i++){
    particles.push({x:x,y:y,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,life:20+Math.random()*15|0,ch:chars[Math.random()*chars.length|0],size:8+Math.random()*6|0});
  }
}

function startGame(){
  initAudio();playStart();
  overlay.style.display='none';
  loginScreen.style.display='none';
  deathScreen.style.display='none';
  snake=[{x:7,y:7},{x:6,y:7},{x:5,y:7}];
  dir={x:1,y:0};ndir={x:1,y:0};
  score=0;alive=true;particles=[];
  scoreEl.textContent='Skor: 0';
  placeFood();draw();
  if(loop)clearInterval(loop);
  loop=setInterval(tick,130);
}

function placeFood(){
  var f;do{f={x:Math.floor(Math.random()*G),y:Math.floor(Math.random()*G)}}
  while(snake.some(function(s){return s.x===f.x&&s.y===f.y}));food=f;
}

function die(){
  alive=false;clearInterval(loop);loop=null;
  playDie();
  var head=snake[0];
  spawnParticles(head.x*S+S/2,head.y*S+S/2,20);
  var flick=0;
  var deathAnim=setInterval(function(){
    flick++;draw();
    if(flick%2===0){ctx.fillStyle='rgba(0,0,0,0.08)';ctx.fillRect(0,0,c.width,c.height)}
    if(flick>8){clearInterval(deathAnim);showDeath()}
  },80);
}

function tick(){
  if(!alive)return;
  dir={x:ndir.x,y:ndir.y};
  var h={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  if(h.x<0||h.x>=G||h.y<0||h.y>=G){die();return}
  for(var i=0;i<snake.length;i++){if(snake[i].x===h.x&&snake[i].y===h.y){die();return}}
  snake.unshift(h);
  if(h.x===food.x&&h.y===food.y){
    playEat();score++;scoreEl.textContent='Skor: '+score;
    spawnParticles(food.x*S+S/2,food.y*S+S/2,8);placeFood();
  }else{snake.pop()}
  draw();
}

function drawRect(x,y,w,h,r,color){
  ctx.fillStyle=color;ctx.beginPath();
  ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();ctx.fill();
}

var frameTick=0;
function draw(){
  frameTick++;
  ctx.fillStyle='#f5f5f7';ctx.fillRect(0,0,c.width,c.height);
  ctx.strokeStyle='rgba(0,0,0,0.04)';ctx.lineWidth=.5;
  for(var i=0;i<=G;i++){ctx.beginPath();ctx.moveTo(i*S,0);ctx.lineTo(i*S,c.height);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i*S);ctx.lineTo(c.width,i*S);ctx.stroke()}
  var pulse=Math.sin(frameTick*.15)*.2+.8;
  ctx.fillStyle='#1d1d1f';ctx.font='bold 14px sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText('üçé',food.x*S+S/2,food.y*S+S/2);
  ctx.textAlign='start';ctx.textBaseline='alphabetic';
  for(var i=snake.length-1;i>=0;i--){
    var s=snake[i],t=i/Math.max(snake.length-1,1),color;
    if(i===0){color='#1d1d1f'}
    else{var gray=Math.round(29+100*t);color='rgb('+gray+','+gray+','+gray+')'}
    drawRect(s.x*S+1,s.y*S+1,S-2,S-2,4,color);
  }
  if(snake.length>0){
    var head=snake[0],hx=head.x*S+S/2,hy=head.y*S+S/2,ex1,ey1,ex2,ey2;
    if(dir.x===1){ex1=hx+3;ey1=hy-3;ex2=hx+3;ey2=hy+3}
    else if(dir.x===-1){ex1=hx-3;ey1=hy-3;ex2=hx-3;ey2=hy+3}
    else if(dir.y===-1){ex1=hx-3;ey1=hy-3;ex2=hx+3;ey2=hy-3}
    else{ex1=hx-3;ey1=hy+3;ex2=hx+3;ey2=hy+3}
    ctx.fillStyle='#1d1d1f';
    ctx.beginPath();ctx.arc(ex1,ey1,1.5,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(ex2,ey2,1.5,0,Math.PI*2);ctx.fill();
  }
  for(var i=particles.length-1;i>=0;i--){
    var p=particles[i];p.x+=p.vx;p.y+=p.vy;p.life--;
    if(p.life<=0){particles.splice(i,1);continue}
    ctx.fillStyle='rgba(29,29,31,'+(p.life/35)+')';ctx.font=p.size+'px sans-serif';ctx.fillText(p.ch,p.x,p.y);
  }
}

// --- CONTROLS ---
document.addEventListener('keydown',function(e){
  if(!alive)return;
  var k=e.key,changed=false;
  if((k==='ArrowUp'||k==='w'||k==='W')&&dir.y!==1){ndir={x:0,y:-1};changed=true}
  else if((k==='ArrowDown'||k==='s'||k==='S')&&dir.y!==-1){ndir={x:0,y:1};changed=true}
  else if((k==='ArrowLeft'||k==='a'||k==='A')&&dir.x!==1){ndir={x:-1,y:0};changed=true}
  else if((k==='ArrowRight'||k==='d'||k==='D')&&dir.x!==-1){ndir={x:1,y:0};changed=true}
  if(changed)playTurn();
  if(k.startsWith('Arrow'))e.preventDefault();
});

var tx,ty;
document.addEventListener('touchstart',function(e){tx=e.touches[0].clientX;ty=e.touches[0].clientY});
document.addEventListener('touchend',function(e){
  if(!alive)return;
  var dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;
  if(Math.abs(dx)<10&&Math.abs(dy)<10)return;
  if(Math.abs(dx)>Math.abs(dy)){if(dx>0&&dir.x!==-1)ndir={x:1,y:0};else if(dx<0&&dir.x!==1)ndir={x:-1,y:0}}
  else{if(dy>0&&dir.y!==-1)ndir={x:0,y:1};else if(dy<0&&dir.y!==1)ndir={x:0,y:-1}}
});

// --- INIT: show login ---
showLogin();
</script>
</body>
</html>
